!function(t){"use strict";function n(){this._eves={}}function e(t){var e=this,r=e._e=new n;e.state=i,e.args=t;var a=e._next=[];r.last(o,function(){var t=function(){r.emit(f),delete e.data,e._par&&e._par._e.emit(u),t=null};if(a.length){h(a,function(t){v(function(){t._init()})});var n=0;r.on(u,function(){n++,a.length==n&&(t(),r.off(u))})}else t()})}function r(){this.init.apply(this,arguments)}var i="wait",a="pending",o="fulfilled",s="rejected",u="wood",f="fire",c=function(){},p=function(t){return Array.prototype.slice.call(t,0)},l=function(t){return Object.prototype.toString.call(t).toLowerCase().replace(/(\[object )|(])/g,"")},h=function(){return[].forEach?function(t,n){return t.forEach(n)}:function(t,n){for(var e=0,r=t.length;r>e;e++)n(t[e],e)}}(),d=function(t,n){for(var e in n)t[e]=n[e];return t},v=function(){var t=!1,n=[];return function(e){t||(t=!0,setTimeout(function(){for(var e=0;e<n.length;e++)n[e]();n=[],t=!1},0)),n.push(e)}}(),m=function(t){var n=t.match(/(.+\/).+/);return n&&n[1]},g=function(t){var n=t.split(/\//g),e=[];return h(n,function(t){return".."==t&&e.length&&".."!=e.slice(-1)[0]?void e.pop():void e.push(t)}),e.join("/")};n.fn=n.prototype,n.prototype={_get:function(t){return this._eves[t]||(this._eves[t]={e:[],o:[]})},on:function(t,n){this._get(t).e.push(n)},one:function(t,n){this._get(t).o.push(n)},first:function(t,n){this._get(t).f=n},last:function(t,n){this._get(t).l=n},off:function(t){delete this._eves[t]},emit:function(t,n){var e=this._get(t),r=e.f;r&&r({name:t,type:"first"},n),delete e.f;for(var i=e.o;i.length;)i.shift()({name:t,type:"one"},n);h(e.e,function(e){e({name:t,type:"on"},n)});var a=e.l;a&&a({name:t,type:"last"},n),delete e.l}},e.prototype={_init:function(){var t=this,n=t._e,e=t.args;t.state=a;var r,i=e.length,u=[];if(!i)return t.state=o,void n.emit(o,{datas:u,state:o});var f=function(e,c,p){n.emit(a,{data:e,state:c,no:p}),e&&e.state==k&&A.error(d({args:t._args},e)),i--,i||(r?n.emit(s,r):(t.state=o,n.emit(o,{datas:u,state:o})),f=r=u=null,n.off(a),n.off(s),n.off(o))};h(e,function(n,e){var i=!1;n.call(t,function(t){i||(u[e]=t,i=!0,f(t,o,e))},function(n){i||(t.state=s,r=r||[],r.push({no:e,data:n}),i=!0,f(n,s,e))})})},then:function(t){var n=this;return n._e.one(o,function(e,r){t.apply(n,r.datas)}),n},"catch":function(t){return this._e.one(s,function(n,e){t(e)}),this},pend:function(t){return this._e.on(a,function(n,e){t(e)}),this},prom:function(){var t=p(arguments),n=new e(t);return n._par=this,this._next.push(n),n},send:function(t){return this.data=t,this},gift:function(t){h(this._next,function(n){n.send(t)})},fire:function(t){return this._e.one(f,t),this}};var _=function(){var t=p(arguments),n=new e(t);return v(function(){n._init()}),n};r.fn=r.prototype,r.fn.init=function(n,e,r){this._pub=e||{};var i=L.toProm(n,this);this._p=r?r.prom.apply(r,i):_.apply(t,i),this._args=n},r.fn.require=function(){var t=new r(p(arguments),this._pub,this._p);return t},r.fn.pend=function(t){var n=this;return n._p.pend(function(e){var r;r=e.state!=o?d({val:n._args[e.no],no:e.no},e.data):d({val:n._args[e.no]},e),t.call(n,r)}),n},r.fn.fail=function(t){var n=this;return n._p["catch"](function(n){var e=[];h(n,function(t){e.push(d({no:t.no},t.data))}),t(e)}),n},r.fn.done=function(t){var n=this;return n._p.then(function(){t.apply(n,arguments)}),n},r.fn.post=function(t){return this._p.send(t),this},r.fn.hand=function(t){return this._p.gift(t),this};var y=function(){var t=new r(p(arguments));return t},b="define",w="defer",j="loading",x="loaded",M="finish",k="error",E=document.head,P={},q={},D={},U={paths:P,dirpaths:q,baseUrl:"",dataMap:D,tempM:{}},L={toProm:function(t,n){var e=[];return h(t,function(t){var r=L.getPath(t,n);e.push(L.agent(r,n))}),e},getPath:function(t,n){if(P[t])t=P[t];else{var e,r;for(var i in q)if(e=new RegExp("^"+i),r=e.test(t)){t=t.replace(e,q[i]);break}}if(!/^.+?\/\//.test(t)){/\?.+$/.test(t)||/.js$/.test(t)||(t+=".js");var a=t.match(/^\.\/(.+)/);t=a?m(n._pub.rel)+a[1]:U.baseUrl+t,t=g(t)}return t},agent:function(t){return function(n,e){var r=D[t];if(!r){var i=[];r=D[t]={state:j,proms:i},r.script=L.loadScript(t,function(){var n=U.tempM,e=n.type||"file";switch(r.type=e,r.state=x,e){case b:L.setDefine(t,function(t){r.state=M,h(i,function(n){n.res(t)}),delete r.proms});break;case w:r.state=M;{r.m=n.val}h(i,function(n){L.runDefer(t,n.d,n.res,n.rej)}),delete r.proms;break;default:r.state=M,h(i,function(t){t.res()}),delete r.proms}var a=n.ids;a&&("string"==l(a)?D[a]=r:"array"==l(a)&&h(a,function(t){D[t]=r})),U.tempM={}},function(){r.state=k,h(i,function(n){n.rej({state:k,url:t})}),U.tempM={}})}switch(r.state){case M:switch(r.type){case b:n(r.m);break;case w:L.runDefer(t,this.data,n,e);break;default:n()}break;case j:case x:r.proms.push({res:n,rej:e,d:this.data});break;case k:e()}}},loadScript:function(t,n,e){var r=document.createElement("script");return r.type="text/javascript",r.setAttribute("async",!0),r.onload=n,r.onerror=e,r.src=t,v(function(){E.appendChild(r)}),r},setDefine:function(t,n){var e,i=D[t],a=U.tempM,o=a.val;if("function"==l(o)){var s={},u={exports:s};e=y(),e._pub.rel=t;var f=!1,c=o.call({FILE:t},function(){var n,i=p(arguments);return n=f?new r(i,{rel:t}):e.require.apply(e,i)},s,u);c&&(u.exports=c),f=!0,e._p.fire(function(){var t=u.exports;i.m=t,n(t)})}else i.m=o,n(o);return e},runDefer:function(t,n,e,i){var a=D[t],o=a.m;o.call({FILE:t,data:n},function(){return new r(p(arguments),{rel:t})},e,function(n){i({state:s,data:n,url:t})})},define:function(t,n){U.tempM={type:b,val:t,ids:n}},defer:function(t,n){U.tempM={type:w,val:t,ids:n}}},S=function(t,n){L.define.call(L,t,n)},$=function(t,n){L.defer.call(L,t,n)},A={config:function(t){U.baseUrl=t.baseUrl||"";for(var n in t.paths)/\/$/.test(n)?q[n]=t.paths[n]:P[n]=t.paths[n]},require:y,define:S,defer:$,use:function(t){var n=L.getPath(t),e=D[n]||{},r=e.type;return r==b?e.m:r},remove:function(t){var n=L.getPath(t),e=D[n];return e?(delete D[n],!0):void 0},extend:function(t){t(U,L,r)},error:c,version:"3"},C=t.sr;if(C){var F=C.config;F&&A.config(F);var I=C.ready;I&&v(I)}t.require||(t.require=y),t.define||(t.define=S),t.defer||(t.defer=$),t.sr=A}(window);